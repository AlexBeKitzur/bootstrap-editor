!function(h,n){CKEDITOR.disableAutoInline=true;var e=h(window),g=h("body");var l=document,i=navigator,b=i.userAgent;var c=window.opera&&opera.buildNumber;var a=/Firefox/.test(b);var k=b.indexOf("Mac")!=-1;window.console=window.console||{log:function(){},error:function(){}};var f="wysiwyg";var j=function(o,d){this.$el=o;this.init(d);};j.elIdx=0;j.prototype={init:function(o){var q=this,p=this.$el;var d=p.attr("contenteditable")?"ckeditor":false;this.options=o||{};this.options.type=(this.options.type||p.data("edit-as")||d||f).toLowerCase();this.options.fullscreen=p.data("fullscreen")!==undefined?p.data("fullscreen"):true;this.options.width=p.data("width")||"100%";this.options.height=p.data("height")||"100";this.options.maxHeight=p.data("max-height")||e.height()*0.6;this.options.nobreaks=p.data("nobreaks")||null;p.addClass("bootstrap-editor bootstrap-editor-"+this.options.type);this.id=++j.elIdx;p.addClass(this.classId="bootstrap-editor-"+this.id);if(!p.attr("id")){p.attr("id","bootstrap-editor-"+this.id);}p.on("init",function(){if(q.options.width==="auto"||q.options.width==="100%"){var s,r;setInterval(function(){if(q.$el.parent().width()!==r){r=q.$el.parent().width();clearTimeout(s);setTimeout(h.proxy(q.fill,q),100);}},100);}});this["init_"+this.options.type](o);},init_ckeditor:function(){var p=this,D=this.$el,z=D.get(0),u=D.attr("placeholder"),C=D.prop("tagName").toLowerCase(),t=false,o=false,s=C==="h1"||C==="h2"||C==="h3"||C==="h4"||C==="h5"||C==="h6";var w=function(){return h("<div>"+D.html()+"</div>").text().trim().length<1;};var B=function(){if(!u){return false;}else{return"<p>"+u+"</p>";}};var A=function(){return h("<div>"+D.html()+"</div>").text().trim()===u;};this.val=function(F){if(F!==undefined){o.setData(F);if(u&&(!F||!F.trim())){o.setData(B());this.$el.addClass("placeheld");}return this;}else{F=o.getData();if(u&&h(F).text().trim()===u){return"";}else{return F;}}};var d=function(F){var G=(F.left+(F.width/2)-(E.width()/2)),H=0;if(G<0){H=(-1*G+15);}else{if(G+E.width()>e.width()){H=e.width()-(G+E.width())-20;}}E.css({top:(F.top-E.height()-18)+"px",left:G+"px"}).show();E.find(".inner").css({left:H+"px"});};var x=function(){E.hide();};this.options.tools=D.data("tools")||!s;this.options.maxLength=D.data("max-length")||false;var E=h("#"+n+"-wysiwyg-toolbar");if(this.options.tools&&!E.length){var r=h('<div class="inner btn-group"></div>');E=h('<div id="'+n+'-wysiwyg-toolbar" class="contenteditable btns"></div>');E.append(r);r.append('<button class="btn btn-large btn-inverse"><i class="icon-white icon-bold"></i></button>');r.append('<button class="btn btn-large btn-inverse"><i class="icon-white icon-italic"></i></button>');r.append('<button class="btn btn-large btn-inverse btn-h1">H1</button>');r.append('<button class="btn btn-large btn-inverse btn-h1">H2</button>');r.append('<button class="btn btn-large btn-inverse"><i class="icon-white icon-quote-left"></i></button>');r.append('<button class="btn btn-large btn-inverse"><i class="icon-white icon-link"></i></button>');g.append(E);}if(s||this.options.nobreaks===true){D.addClass("nobreaks");}if(u){if(w()){t=true;D.html(B());D.addClass("placeheld");}}CKEDITOR.inline(this.$el.attr("id"),{removePlugins:"toolbar,link,liststyle,tabletools,contextmenu",allowedContent:s?null:{a:{attributes:"!href,rel"},p:{attributes:"name"},"i em strong b":true,"h1 h2":true,"ul li":true,blockquote:{classes:"center"}}});o=CKEDITOR.instances[this.$el.attr("id")];var v=function(K){var G=false,J=false,I=window.getSelection(),H=I.anchorNode,F=I.focusNode;while(H&&H!=document.documentElement){if(H===z){G=true;}H=H.parentNode;}while(F&&F!=document.documentElement){if(F===z){J=true;}F=F.parentNode;}if(!G||!J){return false;}return o.getSelection().getNative();};var y;D.keyup(function(F){clearTimeout(y);y=setTimeout(function(){var G=v(F);if(G&&!G.isCollapsed&&G.type!=="Caret"){d(G.getRangeAt(0).getBoundingClientRect());}else{x();}},1);});var q=false;E.find("button").click(function(F){q=true;return false;});h(document).mouseup(function(F){setTimeout(function(){var G=v(F);if(!t&&G&&!G.isCollapsed&&G.type!=="Caret"){d(G.getRangeAt(0).getBoundingClientRect());}else{if(!q){x();}else{q=false;}}},1);});o.on("key",function(I){var G=I.data.keyCode;if(G===9||G===2228233){return true;}if(t&&/[^a-z0-9 ]/i.test(String.fromCharCode(G))){return false;}if(G===13&&(p.options.nobreaks===true||(p.options.nobreaks===null&&s))){return false;}if(t){t=false;D.removeClass("placeheld");if(z.hasChildNodes()&&document.createRange&&window.getSelection){D.empty();var F,H;F=document.createRange();F.selectNodeContents(this);H=window.getSelection();H.removeAllRanges();H.addRange(F);}}});D.mousedown(function(F){if(t){D.focus();return false;}});D.blur(function(F){if(w()){t=true;D.html(B());D.addClass("placeheld");}else{if(A()){D.html(B());D.addClass("placeheld");}}});},init_markdown:function(){},init_source:function(){},init_wysiwyg:function(){var s=this,N=this.$el,z=N.attr("placeholder"),M=this.$el.prop("tagName").toLowerCase(),y=false,x=M==="h1"||M==="h2"||M==="h3"||M==="h4"||M==="h5"||M==="h6",G=N.get(0),O,B;this.options.tools=N.data("tools")||!x;this.options.maxLength=N.data("max-length")||false;var P=h("#"+n+"-wysiwyg-toolbar");if(this.options.tools&&!P.length){var u=h('<div class="inner btn-group"></div>');P=h('<div id="'+n+'-wysiwyg-toolbar" class="contenteditable btns"></div>');P.append(u);u.append('<button class="btn btn-large btn-inverse"><i class="icon-white icon-bold"></i></button>');u.append('<button class="btn btn-large btn-inverse"><i class="icon-white icon-italic"></i></button>');u.append('<button class="btn btn-large btn-inverse btn-h1">H1</button>');u.append('<button class="btn btn-large btn-inverse btn-h1">H2</button>');u.append('<button class="btn btn-large btn-inverse"><i class="icon-white icon-quote-left"></i></button>');u.append('<button class="btn btn-large btn-inverse"><i class="icon-white icon-link"></i></button>');g.append(P);}var v=[],d=[];var K=function(){if(v.length){var Q=v.pop();Q.exec();d.push(Q);if(C()){setTimeout(function(){N.focus();},10);}else{I();}}console.log("undo",v,d);};var w=function(){if(d.length){var Q=d.pop();Q.exec();v.push(Q);if(C()){setTimeout(function(){N.focus();},10);}else{I();}}console.log("redo",v,d);};var r=function(){d=[];var Q=N.html();v.push({__previous__:Q.length?Q:false,exec:function(){var R=N.html();d.push({exec:function(){N.html(R);}});N.html(Q);}});console.log("pushToUndo",v,d);};var C=function(){return h("<div>"+N.html()+"</div>").text().trim().length<1;};var L=function(){if(!z){return false;}else{return"<p>"+z+"</p>";}};var H=function(){return h("<div>"+N.html()+"</div>").text().trim()===z;};var I=function(R){var Q,S;if(document.createRange){Q=document.createRange();Q.selectNodeContents(G);Q.collapse(R?true:false);S=window.getSelection();S.removeAllRanges();S.addRange(Q);}else{if(document.selection){Q=document.body.createTextRange();Q.moveToElementText(G);Q.collapse(R?true:false);Q.select();}}};this.val=function(Q){if(Q!==undefined){this.$el.html(Q);if(z&&(!Q||!Q.trim())){this.$el.html(L());this.$el.addClass("placeheld");}return this;}else{Q=this.$el.html();if(z&&h(Q).text().trim()===z){return"";}else{return Q;}}};var q=function(Q){var R=(Q.left+(Q.width/2)-(P.width()/2)),S=0;if(R<0){S=(-1*R+15);}else{if(R+P.width()>e.width()){S=e.width()-(R+P.width())-20;}}P.css({top:(Q.top-P.height()-18)+"px",left:R+"px"}).show();P.find(".inner").css({left:S+"px"});};var D=function(){P.hide();};var A=function(V){var R=false,U=false,T=window.getSelection(),S=T.anchorNode,Q=T.focusNode;while(S&&S!=document.documentElement){if(S==G){R=true;}S=S.parentNode;}while(Q&&Q!=document.documentElement){if(Q==G){U=true;}Q=Q.parentNode;}O=window.getSelection();if(!R||!U){return false;}if(O.getRangeAt!==undefined){B=O.getRangeAt(0);return true;}else{if(document.createRange&&O.anchorNode&&O.anchorOffset&&O.focusNode&&O.focusOffset){B=document.createRange();B.setStart(O.anchorNode,O.anchorOffset);B.setEnd(O.focusNode,O.focusOffset);return true;}else{return false;}}};var E=function(){if(window.getSelection){sel=window.getSelection();if(sel.getRangeAt&&sel.rangeCount){return sel.getRangeAt(0);}}else{if(document.selection&&document.selection.createRange){return document.selection.createRange();}}return null;};var t=function(Q){if(Q){if(window.getSelection){sel=window.getSelection();sel.removeAllRanges();sel.addRange(Q);}else{if(document.selection&&Q.select){Q.select();}}}};var p=function(U){var S,Q,R;if(window.getSelection){S=window.getSelection();if(S.getRangeAt&&S.rangeCount){Q=S.getRangeAt(0);Q.deleteContents();var T=document.createTextNode(U);Q.insertNode(T);S.removeAllRanges();Q=Q.cloneRange();Q.selectNode(T);Q.collapse(false);S.addRange(Q);}}else{if(document.selection&&document.selection.createRange){Q=document.selection.createRange();Q.pasteHTML(U);Q.select();}}};var o=function(Q){var R=h('<textarea style="position:absolute; left: -1000px; top: '+e.scrollTop()+'px"></textarea>');g.append(R);!function(){var S=E();R.focus();setTimeout(function(){var T=R.val();R.remove();t(S);if(y){y=false;x?N.html(""):N.find("> p").text("");N.removeClass("placeheld");N.text(T);if(A()){S.selectNodeContents(G);J(h(S.commonAncestorContainer));S.selectNodeContents(G);S.collapse(false);O.removeAllRanges();O.addRange(S);}}else{p(T);}},0);}();};N.keydown(function(V){var S=V.keyCode||V.which;var T=S===8;var W=V.metaKey&&S===65;var Q=V.metaKey&&S===90;var R=V.shiftKey&&V.metaKey&&S===90;var U=T||W;if(T){r();}if(U){return true;}if(R){if(y){return false;}w();return false;}if(Q){if(y){return false;}K();return false;}if(S===32||S===13){r();}if(s.options.maxLength&&!y){if(h("<div>"+N.html()+"</div>").text().length>=s.options.maxLength){return false;}}if(c||a){if(((k?V.metaKey:V.ctrlKey)&&V.keyCode==86)||(V.shiftKey&&V.keyCode==45)){o(V);}}});if(!c&&!a){N.on("paste",o);}function J(Q){if(Q.data("editor")===N.data("editor")){N.html("<p>"+N.text()+"</p>");}else{console.log("no");}}var F;N.keyup(function(Q){clearTimeout(F);F=setTimeout(function(){if(A(Q)&&!O.isCollapsed&&O.type!=="Caret"){J(h(B.commonAncestorContainer));q(B.getBoundingClientRect());}else{D();}},1);});N.mousedown(function(Q){if(y){N.focus();return false;}});h(document).mouseup(function(Q){setTimeout(function(){if(!y&&A(Q)&&!O.isCollapsed&&O.type!=="Caret"){q(B.getBoundingClientRect());}else{D();}},1);});if(z){if(C()){y=true;N.html(L());N.addClass("placeheld");}else{r();}N.focus(function(Q){});N.keydown(function(T){var Q=T.keyCode||T.which;if(Q===13&&x){return false;}if(y&&T.metaKey&&Q==65){return false;}if(!Q||/[^a-z0-9 ]/i.test(String.fromCharCode(Q))){return true;}if(y){var R=document.createRange();R.selectNodeContents(N.get(0));var S=window.getSelection();S.removeAllRanges();S.addRange(R);y=false;x?N.html(""):N.find("> p").text("");N.removeClass("placeheld");r();}});N.blur(function(Q){if(C()){y=true;N.html(L());N.addClass("placeheld");}else{if(H()){N.html(L());N.addClass("placeheld");}}});}else{r();}},init_tinymce:function(){this.exec=function(r,q,s,p){this.tinymce.execCommand(r,q,s,p);};this.val=function(p){if(p!==undefined){this.tinymce.setContent(p);if(this.$el.attr("placeholder")&&(!p||!p.trim())){this.tinymce.setContent(this.$el.attr("placeholder"));h(this.tinymce.getDoc()).find("body").addClass("placeheld");}return this;}else{p=this.tinymce.getContent();if(this.$el.attr("placeholder")&&h(p).text().trim()===this.$el.attr("placeholder")){return"";}else{return p;}}};this.fill=function(){this.tinymce.theme.resizeTo(this.$el.parent().width());};this.$el.hide();this.options.css=this.$el.data("tinymce-css")||"css/tinymce-content.css";this.options.tools=this.$el.data("tinymce-tools")||false;this.options.status=this.$el.data("tinymce-status")||false;if(!window.tinyMCE){console.error("tinyMCE not loaded");return false;}var o=this,d=this.$el;tinyMCE.init({mode:"specific_textareas",editor_selector:this.classId,content_css:this.options.css,width:this.options.width,height:this.options.height,theme_advanced_buttons1:"",plugins:"fullscreen,autoresize",fullscreen_new_window:false,autoresize_bottom_margin:20,autoresize_min_height:this.options.height,autoresize_max_height:this.options.maxHeight,fullscreen_settings:{theme_advanced_buttons1:""},setup:function(p){d.trigger("tinymce-setup",[o]);},oninit:function(){o.tinymce=tinyMCE.get(d.attr("id"));o.tinymce.$el=h("#"+o.tinymce.editorContainer).css({position:"relative",display:"inline-block"});o.tinymce.$el.addClass("bootstrap-mce-editor");o.tinymce.formatter.register("fontSizeHuge",{inline:"span",styles:{fontSize:"xx-large"}});o.$tools=h('<div class="tools"></div>');o.$tools.append(o.$btnFormatTools=h('<a class="tool-btn" href="#"><i class="icon-font"></i></a>'));o.$tools.append('<span class="tool-separator"></span>');o.$tools.append(o.$btnUpload=h('<a class="tool-btn" href="#"><i class="icon-paper-clip"></i></a>'));o.$tools.append(o.$formatTools=h('<div class="format-tools"><span class="arrow"></span></div>'));o.$formatTools.append(o.$btnFontFace=h('<a class="tool-btn" href="#"><label>Sans Serif</label><i class="icon-caret-down"></i><div class="select"></div></a>'));o.$formatTools.append('<span class="tool-separator"></span>');o.$formatTools.append(o.$btnFontSize=h('<a class="tool-btn" href="#"><i class="icon-text-height"></i><i class="icon-caret-down"></i><div class="select"></div></a>'));o.$btnFontSize.append(o.$btnFontSizeSelect=h('<div class="select"></div>'));o.$btnFontSizeSelect.append('<a class="font-size font-size-small" href="#">Small</a>');o.$btnFontSizeSelect.append('<a class="font-size font-size-normal" href="#">Normal</a>');o.$btnFontSizeSelect.append('<a class="font-size font-size-large" href="#">Large</a>');o.$btnFontSizeSelect.append('<a class="font-size font-size-huge" data-formatter="fontSize" data-formatter-value="Huge" href="#">Huge</a>');o.$formatTools.append('<span class="tool-separator"></span>');o.$formatTools.append(o.$btnBold=h('<a class="tool-btn" href="#" data-command="bold"><i class="icon-bold"></i></a>'));o.$formatTools.append(o.$btnItalic=h('<a class="tool-btn" href="#" data-command="italic"><i class="icon-italic"></i></a>'));o.$formatTools.append(o.$btnUnderline=h('<a class="tool-btn" href="#" data-command="underline"><i class="icon-underline"></i></a>'));o.$formatTools.append(o.$btnColor=h('<a class="tool-btn" href="#"><i class="icon-font icon-colors"></i><i class="icon-caret-down"></i><div class="select"></div></a>'));o.$formatTools.append('<span class="tool-separator"></span>');o.$formatTools.append(o.$btnOlist=h('<a class="tool-btn" href="#" data-command="insertorderedlist"><i class="icon-list-ol"></i></a>'));o.$formatTools.append(o.$btnUlist=h('<a class="tool-btn" href="#" data-command="insertunorderedlist"><i class="icon-list-ul"></i></a>'));o.$formatTools.append(o.$btnAlign=h('<a class="tool-btn" href="#"><i class="icon-align-left"></i><i class="icon-caret-down"></i></a>'));o.$btnAlign.append(o.$btnAlignSelect=h('<div class="select"></div>'));o.$btnAlignSelect.append(o.$btnAlignLeft=h('<a class="tool-btn" href="#" data-command="justifyleft"><i class="icon-align-left"></i></a>'));o.$btnAlignSelect.append(o.$btnAlignCenter=h('<a class="tool-btn" href="#" data-command="justifycenter"><i class="icon-align-center"></i></a>'));o.$btnAlignSelect.append(o.$btnAlignRight=h('<a class="tool-btn" href="#" data-command="justifyright"><i class="icon-align-right"></i></a>'));o.$btnAlignSelect.append("<br>");o.$btnAlignSelect.append(o.$btnOutdent=h('<a class="tool-btn" href="#" data-command="outdent"><i class="icon-indent-left"></i></a>'));o.$btnAlignSelect.append(o.$btnIndent=h('<a class="tool-btn" href="#" data-command="indent"><i class="icon-indent-right"></i></a>'));o.$btnAlignSelect.append(o.$btnQuote=h('<a class="tool-btn" href="#" data-command="formatblock" data-command-value="blockquote"><i class="icon-quote-left"></i></a>'));o.$formatTools.append('<span class="tool-separator"></span>');o.$formatTools.append(o.$btnRemove=h('<a class="tool-btn" href="#" data-command="removeformat"><i class="icon-remove"></i></a>'));o.$tools.find("a[data-command]").click(function(){var r=h(this);o.tinymce.execCommand(r.data("command"),true,r.data("command-value"));r.parent(".select").parent(".tool-btn").removeClass("active");return false;});o.$tools.find("a.tool-btn:has(> .select)").click(function(){h(this).toggleClass("active");return false;});o.$tools.find('a[data-formatter="fontSize"]').click(function(){var r=h(this).data("data-formatter-value");o.tinymce.formatter.toggle("fontSize"+r);return false;});o.$btnFormatTools.click(function(){o.tinymce.focus();o.tinymce.$el;o.$btnFormatTools.toggleClass("active");o.$formatTools[o.$btnFormatTools.hasClass("active")?"show":"hide"]();o.$tools.toggleClass("format-open",o.$btnFormatTools.hasClass("active"));return false;});var p=function(){o.$tools.find(".select:visible").each(function(){h(this).parent(".tool-btn").removeClass("active");});};h(document).on("click",p);d.bind("tinymce-focus",p);o.tinymce.$el.append(o.$tools);o.tinymce.$el.append('<div class="dropzone"><span>Drop files here</span></div>');if(d.attr("placeholder")){if(!o.tinymce.getContent().length){o.tinymce.setContent(d.attr("placeholder"));h(o.tinymce.getDoc()).find("body").addClass("placeheld");}o.tinymce.onKeyDown.add(function(r,s){if(h(o.tinymce.getContent()).text().trim()===d.attr("placeholder")){o.tinymce.setContent("");h(o.tinymce.getDoc()).find("body").removeClass("placeheld");}});d.bind("tinymce-focus",function(){if(h(o.tinymce.getContent()).text().trim()===d.attr("placeholder")){o.tinymce.setContent("");}h(o.tinymce.getDoc()).find("body").removeClass("placeheld");});d.bind("tinymce-blur",function(){});o.tinymce.onExecCommand.add(function(r,s){if(s==="mceFullScreen"){h(o.tinymce.getDoc()).find("body").toggleClass("placeheld",o.tinymce.getContent()===d.attr("placeholder"));}});}o.tinymce.onEvent.add(function(r,s){d.trigger("tinymce-"+s.type,[o]);});h(o.tinymce.getDoc()).contents().find("body").focus(function(){o.tinymce.$el.addClass("has-focus");d.trigger("tinymce-focus",[o]);});h(o.tinymce.getDoc()).contents().find("body").blur(function(){o.tinymce.$el.removeClass("has-focus");d.trigger("tinymce-blur",[o]);});if(o.options.fullscreen){var q=h('<a href="#"><span class="fullscreen"></span></a>').css({position:"absolute",top:"5px",right:"5px"});o.tinymce.$el.append(q);q.click(function(){if(d.attr("placeholder")){if(h(o.tinymce.getContent()).text().trim()===d.attr("placeholder")){o.tinymce.setContent("");}}o.tinymce.execCommand("mceFullScreen");var r=function(s){if(s.keyCode==27){tinyMCE.execCommand("mceFullScreen");e.unbind("keyup",r);return false;}};e.on("keyup",r);return false;});}if(!o.options.tools){o.tinymce.$el.find(".mceToolbar").parent().hide();}if(!o.options.status){o.tinymce.$el.find(".mceStatusbar").parent().hide();}d.trigger("init",[o,"tinymce"]);d.trigger("tinymce-init",[o]);}});}};var m;e.on("dragover",function(d){clearTimeout(m);g.addClass("dragging");});e.on("dragend",function(d){clearTimeout(m);m=setTimeout(function(){g.removeClass("dragging");},500);});e.on("dragleave",function(d){clearTimeout(m);m=setTimeout(function(){g.removeClass("dragging");},500);});h.fn[n]=function(o){var d=Array.prototype.slice.apply(arguments);return this.each(function(q,s){var p=h(s),r=p.data(n);if(!r){p.data(n,r=new j(p,typeof o!=="string"?o:{}));}if(typeof o==="string"){r[o].apply(r,d.slice(1));}});};h("[data-edit-as]").each(function(){h(this)[n]();});h('[contenteditable="true"]').not('[wysiwyg-ignore="true"]').each(function(){h(this)[n]();});h.valHooks.textarea={set:function(o,p){var d=h(o);if(d.data(n)){d.data(n).val(p);}else{o.value=p;}},get:function(o){var d=h(o);if(d.data(n)){return d.data(n).val();}else{return o.value;}}};}(jQuery,"editor");