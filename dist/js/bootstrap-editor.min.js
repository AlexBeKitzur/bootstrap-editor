!function(h,n){CKEDITOR.disableAutoInline=true;var e=h(window),g=h("body");var l=document,i=navigator,b=i.userAgent;var c=window.opera&&opera.buildNumber;var a=/Firefox/.test(b);var k=b.indexOf("Mac")!=-1;window.console=window.console||{log:function(){},error:function(){}};var f="wysiwyg";var j=function(o,d){this.$el=o;this.init(d);};j.elIdx=0;j.prototype={init:function(o){var q=this,p=this.$el;var d=p.attr("contenteditable")?"ckeditor":false;this.options=o||{};this.options.type=(this.options.type||p.data("edit-as")||d||f).toLowerCase();this.options.fullscreen=p.data("fullscreen")!==undefined?p.data("fullscreen"):true;this.options.width=p.data("width")||"100%";this.options.height=p.data("height")||"100";this.options.maxHeight=p.data("max-height")||e.height()*0.6;this.options.nobreaks=p.data("nobreaks")||null;p.addClass("bootstrap-editor bootstrap-editor-"+this.options.type);this.id=++j.elIdx;p.addClass(this.classId="bootstrap-editor-"+this.id);if(!p.attr("id")){p.attr("id","bootstrap-editor-"+this.id);}p.on("init",function(){if(q.options.width==="auto"||q.options.width==="100%"){var s,r;setInterval(function(){if(q.$el.parent().width()!==r){r=q.$el.parent().width();clearTimeout(s);setTimeout(h.proxy(q.fill,q),100);}},100);}});this["init_"+this.options.type](o);},init_ckeditor:function(){var y=this,C=this.$el,q=C.get(0),p=C.attr("placeholder"),D=C.prop("tagName").toLowerCase(),o=false,z=false,A=D==="h1"||D==="h2"||D==="h3"||D==="h4"||D==="h5"||D==="h6";var v=function(){return h("<div>"+C.html()+"</div>").text().trim().length<1;};var B=function(){if(!p){return false;}else{return"<p>"+p+"</p>";}};var u=function(){return h("<div>"+C.html()+"</div>").text().trim()===p;};this.val=function(E){if(E!==undefined){z.setData(E);if(p&&(!E||!E.trim())){z.setData(B());this.$el.addClass("placeheld");}return this;}else{E=z.getData();if(p&&h(E).text().trim()===p){return"";}else{return E;}}};var t=function(E){var F=(E.left+(E.width/2)-(s.width()/2)),G=0;if(F<0){G=(-1*F+15);}else{if(F+s.width()>e.width()){G=e.width()-(F+s.width())-20;}}s.css({top:(e.scrollTop()+E.top-s.height()-18)+"px",left:F+"px"}).show();s.find(".inner").css({left:G+"px"});};var w=function(){s.hide();};this.options.tools=C.data("tools")||!A;this.options.maxLength=C.data("max-length")||false;var s=h("#"+n+"-wysiwyg-toolbar");if(this.options.tools&&!s.length){var r=h('<div class="inner btn-group"></div>');s=h('<div id="'+n+'-wysiwyg-toolbar" class="contenteditable btns"></div>');s.append(r);r.append('<button class="btn btn-large btn-inverse"><i class="icon-white icon-bold"></i></button>');r.append('<button class="btn btn-large btn-inverse"><i class="icon-white icon-italic"></i></button>');r.append('<button class="btn btn-large btn-inverse btn-h1">H1</button>');r.append('<button class="btn btn-large btn-inverse btn-h1">H2</button>');r.append('<button class="btn btn-large btn-inverse"><i class="icon-white icon-quote-left"></i></button>');r.append('<button class="btn btn-large btn-inverse"><i class="icon-white icon-link"></i></button>');g.append(s);}if(A||this.options.nobreaks===true){C.addClass("nobreaks");}if(p){if(v()){o=true;C.html(B());C.addClass("placeheld");}}CKEDITOR.inline(this.$el.attr("id"),{removePlugins:"toolbar,link,liststyle,tabletools,contextmenu",allowedContent:A?null:{a:{attributes:"!href,rel"},p:{attributes:"name"},"i em strong b":true,"h1 h2":true,"ul li":true,blockquote:{classes:"center"}}});z=CKEDITOR.instances[this.$el.attr("id")];this.getRange=function(){var F=z.getSelection().getNative();if(F===null){return false;}if(F.getRangeAt){return F.getRangeAt(0);}else{var E=document.createRange();E.setStart(F.anchorNode,F.anchorOffset);E.setEnd(F.focusNode,F.focusOffset);return E;}};var d;C.keyup(function(E){clearTimeout(d);d=setTimeout(function(){var F=y.getRange();if(F&&!F.collapsed){t(F.getBoundingClientRect());}else{w();}},1);});var x=false;s.find("button").click(function(E){x=true;return false;});h(document).mouseup(function(E){setTimeout(function(){var F=y.getRange();if(!o&&F&&!F.collapsed){t(F.getBoundingClientRect());}else{if(!x){w();}else{x=false;}}},1);});z.on("key",function(H){var F=H.data.keyCode;if(F===9||F===2228233){return true;}if(o&&/[^a-z0-9 ]/i.test(String.fromCharCode(F))){return false;}if(F===13&&(y.options.nobreaks===true||(y.options.nobreaks===null&&A))){return false;}if(o){o=false;C.empty().removeClass("placeheld");var E=z.createRange(),G=z.getSelection();E.selectNodeContents(z.document.getBody());G.removeAllRanges();G.selectRanges(E);}});C.mousedown(function(E){if(o){C.focus();return false;}});C.blur(function(E){if(v()){o=true;C.html(B());C.addClass("placeheld");}else{if(u()){C.html(B());C.addClass("placeheld");}}});},init_markdown:function(){},init_source:function(){},init_tinymce:function(){this.exec=function(r,q,s,p){this.tinymce.execCommand(r,q,s,p);};this.val=function(p){if(p!==undefined){this.tinymce.setContent(p);if(this.$el.attr("placeholder")&&(!p||!p.trim())){this.tinymce.setContent(this.$el.attr("placeholder"));h(this.tinymce.getDoc()).find("body").addClass("placeheld");}return this;}else{p=this.tinymce.getContent();if(this.$el.attr("placeholder")&&h(p).text().trim()===this.$el.attr("placeholder")){return"";}else{return p;}}};this.fill=function(){this.tinymce.theme.resizeTo(this.$el.parent().width());};this.$el.hide();this.options.css=this.$el.data("tinymce-css")||"css/tinymce-content.css";this.options.tools=this.$el.data("tinymce-tools")||false;this.options.status=this.$el.data("tinymce-status")||false;if(!window.tinyMCE){console.error("tinyMCE not loaded");return false;}var o=this,d=this.$el;tinyMCE.init({mode:"specific_textareas",editor_selector:this.classId,content_css:this.options.css,width:this.options.width,height:this.options.height,theme_advanced_buttons1:"",plugins:"fullscreen,autoresize",fullscreen_new_window:false,autoresize_bottom_margin:20,autoresize_min_height:this.options.height,autoresize_max_height:this.options.maxHeight,fullscreen_settings:{theme_advanced_buttons1:""},setup:function(p){d.trigger("tinymce-setup",[o]);},oninit:function(){o.tinymce=tinyMCE.get(d.attr("id"));o.tinymce.$el=h("#"+o.tinymce.editorContainer).css({position:"relative",display:"inline-block"});o.tinymce.$el.addClass("bootstrap-mce-editor");o.tinymce.formatter.register("fontSizeHuge",{inline:"span",styles:{fontSize:"xx-large"}});o.$tools=h('<div class="tools"></div>');o.$tools.append(o.$btnFormatTools=h('<a class="tool-btn" href="#"><i class="icon-font"></i></a>'));o.$tools.append('<span class="tool-separator"></span>');o.$tools.append(o.$btnUpload=h('<a class="tool-btn" href="#"><i class="icon-paper-clip"></i></a>'));o.$tools.append(o.$formatTools=h('<div class="format-tools"><span class="arrow"></span></div>'));o.$formatTools.append(o.$btnFontFace=h('<a class="tool-btn" href="#"><label>Sans Serif</label><i class="icon-caret-down"></i><div class="select"></div></a>'));o.$formatTools.append('<span class="tool-separator"></span>');o.$formatTools.append(o.$btnFontSize=h('<a class="tool-btn" href="#"><i class="icon-text-height"></i><i class="icon-caret-down"></i><div class="select"></div></a>'));o.$btnFontSize.append(o.$btnFontSizeSelect=h('<div class="select"></div>'));o.$btnFontSizeSelect.append('<a class="font-size font-size-small" href="#">Small</a>');o.$btnFontSizeSelect.append('<a class="font-size font-size-normal" href="#">Normal</a>');o.$btnFontSizeSelect.append('<a class="font-size font-size-large" href="#">Large</a>');o.$btnFontSizeSelect.append('<a class="font-size font-size-huge" data-formatter="fontSize" data-formatter-value="Huge" href="#">Huge</a>');o.$formatTools.append('<span class="tool-separator"></span>');o.$formatTools.append(o.$btnBold=h('<a class="tool-btn" href="#" data-command="bold"><i class="icon-bold"></i></a>'));o.$formatTools.append(o.$btnItalic=h('<a class="tool-btn" href="#" data-command="italic"><i class="icon-italic"></i></a>'));o.$formatTools.append(o.$btnUnderline=h('<a class="tool-btn" href="#" data-command="underline"><i class="icon-underline"></i></a>'));o.$formatTools.append(o.$btnColor=h('<a class="tool-btn" href="#"><i class="icon-font icon-colors"></i><i class="icon-caret-down"></i><div class="select"></div></a>'));o.$formatTools.append('<span class="tool-separator"></span>');o.$formatTools.append(o.$btnOlist=h('<a class="tool-btn" href="#" data-command="insertorderedlist"><i class="icon-list-ol"></i></a>'));o.$formatTools.append(o.$btnUlist=h('<a class="tool-btn" href="#" data-command="insertunorderedlist"><i class="icon-list-ul"></i></a>'));o.$formatTools.append(o.$btnAlign=h('<a class="tool-btn" href="#"><i class="icon-align-left"></i><i class="icon-caret-down"></i></a>'));o.$btnAlign.append(o.$btnAlignSelect=h('<div class="select"></div>'));o.$btnAlignSelect.append(o.$btnAlignLeft=h('<a class="tool-btn" href="#" data-command="justifyleft"><i class="icon-align-left"></i></a>'));o.$btnAlignSelect.append(o.$btnAlignCenter=h('<a class="tool-btn" href="#" data-command="justifycenter"><i class="icon-align-center"></i></a>'));o.$btnAlignSelect.append(o.$btnAlignRight=h('<a class="tool-btn" href="#" data-command="justifyright"><i class="icon-align-right"></i></a>'));o.$btnAlignSelect.append("<br>");o.$btnAlignSelect.append(o.$btnOutdent=h('<a class="tool-btn" href="#" data-command="outdent"><i class="icon-indent-left"></i></a>'));o.$btnAlignSelect.append(o.$btnIndent=h('<a class="tool-btn" href="#" data-command="indent"><i class="icon-indent-right"></i></a>'));o.$btnAlignSelect.append(o.$btnQuote=h('<a class="tool-btn" href="#" data-command="formatblock" data-command-value="blockquote"><i class="icon-quote-left"></i></a>'));o.$formatTools.append('<span class="tool-separator"></span>');o.$formatTools.append(o.$btnRemove=h('<a class="tool-btn" href="#" data-command="removeformat"><i class="icon-remove"></i></a>'));o.$tools.find("a[data-command]").click(function(){var r=h(this);o.tinymce.execCommand(r.data("command"),true,r.data("command-value"));r.parent(".select").parent(".tool-btn").removeClass("active");return false;});o.$tools.find("a.tool-btn:has(> .select)").click(function(){h(this).toggleClass("active");return false;});o.$tools.find('a[data-formatter="fontSize"]').click(function(){var r=h(this).data("data-formatter-value");o.tinymce.formatter.toggle("fontSize"+r);return false;});o.$btnFormatTools.click(function(){o.tinymce.focus();o.tinymce.$el;o.$btnFormatTools.toggleClass("active");o.$formatTools[o.$btnFormatTools.hasClass("active")?"show":"hide"]();o.$tools.toggleClass("format-open",o.$btnFormatTools.hasClass("active"));return false;});var p=function(){o.$tools.find(".select:visible").each(function(){h(this).parent(".tool-btn").removeClass("active");});};h(document).on("click",p);d.bind("tinymce-focus",p);o.tinymce.$el.append(o.$tools);o.tinymce.$el.append('<div class="dropzone"><span>Drop files here</span></div>');if(d.attr("placeholder")){if(!o.tinymce.getContent().length){o.tinymce.setContent(d.attr("placeholder"));h(o.tinymce.getDoc()).find("body").addClass("placeheld");}o.tinymce.onKeyDown.add(function(r,s){if(h(o.tinymce.getContent()).text().trim()===d.attr("placeholder")){o.tinymce.setContent("");h(o.tinymce.getDoc()).find("body").removeClass("placeheld");}});d.bind("tinymce-focus",function(){if(h(o.tinymce.getContent()).text().trim()===d.attr("placeholder")){o.tinymce.setContent("");}h(o.tinymce.getDoc()).find("body").removeClass("placeheld");});d.bind("tinymce-blur",function(){});o.tinymce.onExecCommand.add(function(r,s){if(s==="mceFullScreen"){h(o.tinymce.getDoc()).find("body").toggleClass("placeheld",o.tinymce.getContent()===d.attr("placeholder"));}});}o.tinymce.onEvent.add(function(r,s){d.trigger("tinymce-"+s.type,[o]);});h(o.tinymce.getDoc()).contents().find("body").focus(function(){o.tinymce.$el.addClass("has-focus");d.trigger("tinymce-focus",[o]);});h(o.tinymce.getDoc()).contents().find("body").blur(function(){o.tinymce.$el.removeClass("has-focus");d.trigger("tinymce-blur",[o]);});if(o.options.fullscreen){var q=h('<a href="#"><span class="fullscreen"></span></a>').css({position:"absolute",top:"5px",right:"5px"});o.tinymce.$el.append(q);q.click(function(){if(d.attr("placeholder")){if(h(o.tinymce.getContent()).text().trim()===d.attr("placeholder")){o.tinymce.setContent("");}}o.tinymce.execCommand("mceFullScreen");var r=function(s){if(s.keyCode==27){tinyMCE.execCommand("mceFullScreen");e.unbind("keyup",r);return false;}};e.on("keyup",r);return false;});}if(!o.options.tools){o.tinymce.$el.find(".mceToolbar").parent().hide();}if(!o.options.status){o.tinymce.$el.find(".mceStatusbar").parent().hide();}d.trigger("init",[o,"tinymce"]);d.trigger("tinymce-init",[o]);}});}};var m;e.on("dragover",function(d){clearTimeout(m);g.addClass("dragging");});e.on("dragend",function(d){clearTimeout(m);m=setTimeout(function(){g.removeClass("dragging");},500);});e.on("dragleave",function(d){clearTimeout(m);m=setTimeout(function(){g.removeClass("dragging");},500);});h.fn[n]=function(o){var d=Array.prototype.slice.apply(arguments);return this.each(function(q,s){var p=h(s),r=p.data(n);if(!r){p.data(n,r=new j(p,typeof o!=="string"?o:{}));}if(typeof o==="string"){r[o].apply(r,d.slice(1));}});};h("[data-edit-as]").each(function(){h(this)[n]();});h('[contenteditable="true"]').not('[wysiwyg-ignore="true"]').each(function(){h(this)[n]();});h.valHooks.textarea={set:function(o,p){var d=h(o);if(d.data(n)){d.data(n).val(p);}else{o.value=p;}},get:function(o){var d=h(o);if(d.data(n)){return d.data(n).val();}else{return o.value;}}};}(jQuery,"editor");